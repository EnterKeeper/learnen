{% extends "base.html" %}

{% block content %}
    <div class="card p-4">
        <h2 class="text-center">Create poll</h2>
        <form method="post" enctype="multipart/form-data" novalidate>
            {{ form.hidden_tag() }}
            {% for field in form if field.name not in ("csrf_token", "submit", "options") %}
                <div class="form-field mb-2">
                    {% set mark_field_class = "text-danger" if field.errors else "" %}
                    {{ field.label(class="form-label mb-1 " + mark_field_class) }}
                    {{ field(class="form-control", aria_describedby=field.name + "Help") }}
                    <div id="{{ field.name + "Help" }}" class="form-text">{{ field.description }}</div>
                </div>
            {% endfor %}
            <div class="options">
                {% set mark_field_class = "text-danger" if form.options.errors else "" %}
                <label class="form-label mb-1 {{ mark_field_class }}">Options</label>
                <div class="input-fields-wrap"></div>
                <button class="add-option-btn btn btn-secondary mb-2">Add choice</button>
            </div>
            {{ form.submit(class="btn btn-primary mt-2") }}
        </form>
    </div>
    <script>
        $(document).ready(function () {
            var min_fields = 1;
            var max_fields = 10;
            var wrapper = $(".input-fields-wrap");
            var add_button = $(".add-option-btn");

            function add_field() {
                var field_name = "options-" + x
                var input_field = `
                <div class="input-option row mb-2">
                    <div class="col-auto">
                        <input class="form-control" type="text" id="${field_name}" name="${field_name}">
                    </div>
                    <button class="remove-option btn btn-secondary col-auto">X</button>
                </div>
                `;
                if (x < max_fields) {
                    x++;
                    $(wrapper).append(input_field);
                }
            }

            var x = 0;
            add_field();
            $(add_button).click(function (e) {
                e.preventDefault();
                add_field();
            });

            $(wrapper).on("click", ".remove-option", function (e) {
                e.preventDefault();
                if (x > min_fields) {
                    $(this).parent(".input-option").remove();
                    x--;
                }
            })
        });
    </script>
{% endblock %}